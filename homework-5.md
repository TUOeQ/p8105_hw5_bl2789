Homework 5
================
Bingkun Luo
11/2/2019

### Problem 1

``` r
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

General glance for the data:

``` r
str(iris_with_missing)
```

    ## Classes 'tbl_df', 'tbl' and 'data.frame':    150 obs. of  5 variables:
    ##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 NA 5 4.4 4.9 ...
    ##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
    ##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 NA ...
    ##  $ Petal.Width : num  0.2 0.2 0.2 NA 0.2 0.4 0.3 0.2 0.2 0.1 ...
    ##  $ Species     : chr  "setosa" "setosa" "setosa" "setosa" ...

``` r
kable(head(iris_with_missing),format = "markdown")
```

| Sepal.Length | Sepal.Width | Petal.Length | Petal.Width | Species |
| -----------: | ----------: | -----------: | ----------: | :------ |
|          5.1 |         3.5 |          1.4 |         0.2 | setosa  |
|          4.9 |         3.0 |          1.4 |         0.2 | setosa  |
|          4.7 |         3.2 |          1.3 |         0.2 | setosa  |
|          4.6 |         3.1 |          1.5 |          NA | setosa  |
|          5.0 |         3.6 |          1.4 |         0.2 | setosa  |
|          5.4 |         3.9 |          1.7 |         0.4 | setosa  |

Since there is only two cases for missing value, either numeric or
character, we apply the function below and there is the table for the
final result of replacing iris missing data:

``` r
replace = function(x){
        if (class(x) == "numeric") {replace_na(x, mean(x, na.rm = TRUE))}       
        else if (class(x) == "character") {replace_na(x, "virginica")} 
                }

##apply using map

final_iris = map_df(iris_with_missing, replace)

kable(final_iris,format = "markdown",digits = 3)
```

| Sepal.Length | Sepal.Width | Petal.Length | Petal.Width | Species    |
| -----------: | ----------: | -----------: | ----------: | :--------- |
|        5.100 |       3.500 |        1.400 |       0.200 | setosa     |
|        4.900 |       3.000 |        1.400 |       0.200 | setosa     |
|        4.700 |       3.200 |        1.300 |       0.200 | setosa     |
|        4.600 |       3.100 |        1.500 |       1.192 | setosa     |
|        5.000 |       3.600 |        1.400 |       0.200 | setosa     |
|        5.400 |       3.900 |        1.700 |       0.400 | setosa     |
|        5.819 |       3.400 |        1.400 |       0.300 | setosa     |
|        5.000 |       3.400 |        1.500 |       0.200 | setosa     |
|        4.400 |       2.900 |        1.400 |       0.200 | setosa     |
|        4.900 |       3.100 |        3.765 |       0.100 | setosa     |
|        5.400 |       3.075 |        1.500 |       0.200 | setosa     |
|        4.800 |       3.400 |        1.600 |       0.200 | setosa     |
|        5.819 |       3.075 |        1.400 |       0.100 | setosa     |
|        4.300 |       3.000 |        3.765 |       0.100 | setosa     |
|        5.819 |       4.000 |        3.765 |       0.200 | setosa     |
|        5.700 |       4.400 |        1.500 |       0.400 | setosa     |
|        5.400 |       3.900 |        1.300 |       0.400 | setosa     |
|        5.100 |       3.500 |        1.400 |       1.192 | setosa     |
|        5.700 |       3.800 |        1.700 |       0.300 | setosa     |
|        5.100 |       3.800 |        1.500 |       1.192 | setosa     |
|        5.400 |       3.400 |        1.700 |       0.200 | setosa     |
|        5.100 |       3.700 |        1.500 |       0.400 | virginica  |
|        4.600 |       3.600 |        1.000 |       0.200 | setosa     |
|        5.819 |       3.300 |        3.765 |       0.500 | setosa     |
|        4.800 |       3.400 |        1.900 |       0.200 | virginica  |
|        5.000 |       3.000 |        3.765 |       0.200 | setosa     |
|        5.000 |       3.400 |        1.600 |       0.400 | virginica  |
|        5.200 |       3.500 |        1.500 |       0.200 | setosa     |
|        5.819 |       3.400 |        1.400 |       0.200 | setosa     |
|        4.700 |       3.200 |        1.600 |       0.200 | setosa     |
|        4.800 |       3.100 |        3.765 |       0.200 | setosa     |
|        5.400 |       3.075 |        1.500 |       0.400 | setosa     |
|        5.200 |       3.075 |        1.500 |       0.100 | setosa     |
|        5.500 |       4.200 |        1.400 |       0.200 | setosa     |
|        4.900 |       3.100 |        3.765 |       0.200 | setosa     |
|        5.000 |       3.200 |        1.200 |       0.200 | setosa     |
|        5.500 |       3.500 |        1.300 |       0.200 | setosa     |
|        4.900 |       3.600 |        1.400 |       0.100 | setosa     |
|        4.400 |       3.000 |        1.300 |       1.192 | setosa     |
|        5.100 |       3.400 |        1.500 |       0.200 | setosa     |
|        5.000 |       3.500 |        1.300 |       0.300 | setosa     |
|        4.500 |       3.075 |        1.300 |       1.192 | virginica  |
|        4.400 |       3.200 |        1.300 |       0.200 | setosa     |
|        5.000 |       3.500 |        1.600 |       0.600 | setosa     |
|        5.100 |       3.800 |        1.900 |       0.400 | setosa     |
|        4.800 |       3.000 |        1.400 |       0.300 | virginica  |
|        5.100 |       3.800 |        1.600 |       0.200 | setosa     |
|        4.600 |       3.200 |        3.765 |       0.200 | setosa     |
|        5.300 |       3.700 |        1.500 |       0.200 | setosa     |
|        5.000 |       3.075 |        1.400 |       0.200 | setosa     |
|        7.000 |       3.075 |        4.700 |       1.400 | virginica  |
|        6.400 |       3.200 |        4.500 |       1.500 | versicolor |
|        6.900 |       3.100 |        4.900 |       1.500 | versicolor |
|        5.500 |       2.300 |        4.000 |       1.300 | versicolor |
|        6.500 |       2.800 |        4.600 |       1.500 | versicolor |
|        5.700 |       2.800 |        4.500 |       1.300 | versicolor |
|        6.300 |       3.300 |        4.700 |       1.600 | virginica  |
|        4.900 |       2.400 |        3.765 |       1.000 | versicolor |
|        6.600 |       2.900 |        4.600 |       1.300 | virginica  |
|        5.200 |       2.700 |        3.900 |       1.400 | versicolor |
|        5.000 |       2.000 |        3.765 |       1.000 | versicolor |
|        5.900 |       3.000 |        4.200 |       1.500 | versicolor |
|        6.000 |       2.200 |        4.000 |       1.192 | versicolor |
|        6.100 |       2.900 |        4.700 |       1.400 | versicolor |
|        5.600 |       2.900 |        3.600 |       1.300 | versicolor |
|        6.700 |       3.100 |        4.400 |       1.400 | versicolor |
|        5.600 |       3.000 |        4.500 |       1.500 | versicolor |
|        5.800 |       3.075 |        4.100 |       1.000 | versicolor |
|        6.200 |       2.200 |        4.500 |       1.500 | versicolor |
|        5.600 |       2.500 |        3.900 |       1.100 | versicolor |
|        5.900 |       3.200 |        4.800 |       1.800 | versicolor |
|        5.819 |       2.800 |        4.000 |       1.300 | virginica  |
|        6.300 |       2.500 |        4.900 |       1.500 | versicolor |
|        5.819 |       2.800 |        3.765 |       1.200 | versicolor |
|        6.400 |       2.900 |        4.300 |       1.300 | versicolor |
|        6.600 |       3.000 |        4.400 |       1.400 | versicolor |
|        6.800 |       2.800 |        4.800 |       1.400 | versicolor |
|        6.700 |       3.075 |        5.000 |       1.192 | versicolor |
|        6.000 |       3.075 |        4.500 |       1.192 | versicolor |
|        5.700 |       2.600 |        3.500 |       1.000 | virginica  |
|        5.500 |       2.400 |        3.800 |       1.100 | versicolor |
|        5.819 |       2.400 |        3.700 |       1.000 | versicolor |
|        5.800 |       2.700 |        3.900 |       1.200 | versicolor |
|        6.000 |       2.700 |        5.100 |       1.600 | versicolor |
|        5.400 |       3.000 |        4.500 |       1.500 | versicolor |
|        5.819 |       3.400 |        4.500 |       1.600 | versicolor |
|        6.700 |       3.100 |        4.700 |       1.192 | versicolor |
|        5.819 |       3.075 |        4.400 |       1.300 | versicolor |
|        5.600 |       3.000 |        3.765 |       1.192 | versicolor |
|        5.500 |       2.500 |        4.000 |       1.192 | versicolor |
|        5.500 |       3.075 |        4.400 |       1.200 | versicolor |
|        5.819 |       3.075 |        4.600 |       1.192 | versicolor |
|        5.800 |       3.075 |        4.000 |       1.192 | versicolor |
|        5.000 |       2.300 |        3.300 |       1.192 | virginica  |
|        5.819 |       2.700 |        4.200 |       1.300 | versicolor |
|        5.700 |       3.000 |        4.200 |       1.200 | versicolor |
|        5.700 |       2.900 |        4.200 |       1.300 | versicolor |
|        6.200 |       2.900 |        4.300 |       1.300 | versicolor |
|        5.100 |       2.500 |        3.000 |       1.192 | versicolor |
|        5.700 |       2.800 |        4.100 |       1.300 | virginica  |
|        6.300 |       3.075 |        3.765 |       2.500 | virginica  |
|        5.800 |       2.700 |        5.100 |       1.900 | virginica  |
|        7.100 |       3.000 |        5.900 |       2.100 | virginica  |
|        6.300 |       2.900 |        5.600 |       1.800 | virginica  |
|        6.500 |       3.075 |        5.800 |       2.200 | virginica  |
|        7.600 |       3.000 |        6.600 |       2.100 | virginica  |
|        4.900 |       2.500 |        4.500 |       1.700 | virginica  |
|        7.300 |       2.900 |        6.300 |       1.800 | virginica  |
|        6.700 |       3.075 |        3.765 |       1.800 | virginica  |
|        5.819 |       3.600 |        3.765 |       2.500 | virginica  |
|        6.500 |       3.200 |        5.100 |       2.000 | virginica  |
|        5.819 |       2.700 |        5.300 |       1.900 | virginica  |
|        6.800 |       3.000 |        5.500 |       2.100 | virginica  |
|        5.700 |       3.075 |        5.000 |       2.000 | virginica  |
|        5.800 |       2.800 |        5.100 |       2.400 | virginica  |
|        6.400 |       3.200 |        5.300 |       2.300 | virginica  |
|        6.500 |       3.000 |        3.765 |       1.800 | virginica  |
|        7.700 |       3.800 |        6.700 |       1.192 | virginica  |
|        7.700 |       2.600 |        6.900 |       2.300 | virginica  |
|        6.000 |       2.200 |        5.000 |       1.500 | virginica  |
|        5.819 |       3.200 |        5.700 |       1.192 | virginica  |
|        5.600 |       3.075 |        4.900 |       2.000 | virginica  |
|        7.700 |       2.800 |        6.700 |       2.000 | virginica  |
|        6.300 |       2.700 |        4.900 |       1.800 | virginica  |
|        6.700 |       3.300 |        5.700 |       2.100 | virginica  |
|        7.200 |       3.200 |        6.000 |       1.800 | virginica  |
|        6.200 |       2.800 |        4.800 |       1.800 | virginica  |
|        6.100 |       3.000 |        4.900 |       1.800 | virginica  |
|        6.400 |       2.800 |        5.600 |       2.100 | virginica  |
|        7.200 |       3.000 |        5.800 |       1.600 | virginica  |
|        7.400 |       2.800 |        6.100 |       1.192 | virginica  |
|        7.900 |       3.800 |        3.765 |       2.000 | virginica  |
|        6.400 |       2.800 |        3.765 |       2.200 | virginica  |
|        5.819 |       2.800 |        5.100 |       1.500 | virginica  |
|        6.100 |       3.075 |        5.600 |       1.400 | virginica  |
|        5.819 |       3.000 |        6.100 |       2.300 | virginica  |
|        5.819 |       3.400 |        5.600 |       1.192 | virginica  |
|        6.400 |       3.100 |        5.500 |       1.192 | virginica  |
|        6.000 |       3.000 |        4.800 |       1.800 | virginica  |
|        6.900 |       3.100 |        5.400 |       2.100 | virginica  |
|        6.700 |       3.100 |        5.600 |       2.400 | virginica  |
|        6.900 |       3.100 |        5.100 |       2.300 | virginica  |
|        5.819 |       2.700 |        5.100 |       1.900 | virginica  |
|        6.800 |       3.200 |        3.765 |       2.300 | virginica  |
|        6.700 |       3.300 |        3.765 |       2.500 | virginica  |
|        6.700 |       3.000 |        5.200 |       2.300 | virginica  |
|        6.300 |       2.500 |        5.000 |       1.900 | virginica  |
|        6.500 |       3.000 |        5.200 |       2.000 | virginica  |
|        5.819 |       3.400 |        5.400 |       2.300 | virginica  |
|        5.900 |       3.000 |        5.100 |       1.800 | virginica  |

### Problem 2

``` r
input_files = list.files(path = './data/data', full.names = TRUE)


input_data = purrr::map_df(input_files, ~read.csv(.))

output_data = input_data%>%
       pivot_longer(week_1:week_8,
       names_to = "week",
       values_to = "data")%>%
       mutate(subject_id = c(rep("con_1",8),rep("con_2",8),
                     rep("con_3",8),rep("con_4",8),
                     rep("con_5",8),rep("con_6",8),rep("con_7",8),rep("con_8",8),
                     rep("con_9",8),rep("con_10",8),
                     rep("exp_1",8),rep("exp_2",8),rep("exp_3",8),rep("exp_4",8),
                     rep("exp_5",8),rep("exp_6",8),rep("exp_7",8),rep("exp_8",8),
                     rep("exp_9",8),rep("exp_10",8)),
              type = c(rep("control",80),rep("experiment",80)),
              type = as.factor(type))%>%
  group_by(week)
```

#### Graph

``` r
ggplot(output_data ,aes(x = week, y = data, group = subject_id, color = type)) +
  geom_line() +
   labs(
    title = "Plot for control arm vs. experiment arm",
    x = "Observation time",
    y = "Data for arm",
    caption = "Data from zip")
```

![](homework-5_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

*Comments*:

The observed data shows that the experiment arms have a overall larger
number than the control group. Experiment arm data has an increasing
trend over the study period, which is eight weeks, at the end of the
study experiment data could be doubled. Whereas, the control group seems
more flat over time and did not develop a trend.

### Problem 3

#### Step 1

``` r
simulate_fun = function(n,beta_0,beta_1,var){
  tibble(
  x = rnorm(n),
  y = beta_0+beta_1*x+rnorm(n,mean = 0,sd = sqrt(var)))
}


set.seed(1)
data_1 = rerun(10000, simulate_fun(30,2,0,50))
linear = map(data_1,~broom::tidy(lm(y~x, data = .)))

summary_1 =  data_1%>%
             tibble(beta_1 = 0,
                    linear,
                    estimate = map(linear, ~ .x[2,2]),
                    p_value = map(linear, ~ .x[2,5]))%>% 
             unnest(estimate:p_value) %>% 
             select(-linear)
  

summary_1
```

    ## # A tibble: 10,000 x 4
    ##    .                 beta_1 estimate p.value
    ##    <list>             <dbl>    <dbl>   <dbl>
    ##  1 <tibble [30 x 2]>      0  0.296     0.798
    ##  2 <tibble [30 x 2]>      0  0.00648   0.996
    ##  3 <tibble [30 x 2]>      0 -2.16      0.155
    ##  4 <tibble [30 x 2]>      0 -0.454     0.718
    ##  5 <tibble [30 x 2]>      0 -0.514     0.730
    ##  6 <tibble [30 x 2]>      0  1.71      0.243
    ##  7 <tibble [30 x 2]>      0 -1.18      0.322
    ##  8 <tibble [30 x 2]>      0  1.09      0.366
    ##  9 <tibble [30 x 2]>      0  0.806     0.377
    ## 10 <tibble [30 x 2]>      0  2.35      0.131
    ## # ... with 9,990 more rows

``` r
kable(head(summary_1),digits = 3)
```

<table>

<thead>

<tr>

<th style="text-align:left;">

.

</th>

<th style="text-align:right;">

beta\_1

</th>

<th style="text-align:right;">

estimate

</th>

<th style="text-align:right;">

p.value

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

list(x = c(-0.626453810742332, 0.183643324222082, -0.835628612410047,
1.59528080213779, 0.329507771815361, -0.820468384118015,
0.487429052428485, 0.738324705129217, 0.575781351653492,
-0.305388387156356, 1.51178116845085, 0.389843236411431,
-0.621240580541804, -2.2146998871775, 1.12493091814311,
-0.0449336090152309, -0.0161902630989461, 0.943836210685299,
0.821221195098089, 0.593901321217509, 0.918977371608218,
0.782136300731067, 0.0745649833651906, -1.98935169586337,
0.61982574789471, -0.0561287395290008, -0.155795506705329,
-1.47075238389927, -0.47815005510862, 0.417941560199702), y =
c(11.6073152434568, 1.27318100973014, 4.74125225407147, 1.6195409094181,
-7.7372815073125, -0.934454698647535, -0.788051000223179,
1.58059094970313, 9.77835400007058, 7.39646746971448, 0.83664249423891,
0.208462378826585, 6.92827528987355, 5.93620322619137,
-2.87023822196816, -3.00274623144556, 4.5779837772525, 7.4343484248998,
1.20559231547951, 8.23037248331637, 4.81503367637794, -2.32768012932765,
4.41208047002473, -5.98580303660563, 12.1330077707385, 16.0035419769464,
-0.596647962068047, -5.38314674740101, 6.02852611939604,
1.04501973765406))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

0.296

</td>

<td style="text-align:right;">

0.798

</td>

</tr>

<tr>

<td style="text-align:left;">

list(x = c(2.40161776050478, -0.0392400027331692, 0.689739362450777,
0.0280021587806661, -0.743273208882405, 0.188792299514343,
-1.80495862889104, 1.46555486156289, 0.153253338211898,
2.17261167036215, 0.475509528899663, -0.709946430921815,
0.610726353489055, -0.934097631644252, -1.2536334002391,
0.291446235517463, -0.443291873218433, 0.00110535163162413,
0.0743413241516641, -0.589520946188072, -0.568668732818502,
-0.135178615123832, 1.1780869965732, -1.52356680042976,
0.593946187628422, 0.332950371213518, 1.06309983727636,
-0.304183923634301, 0.370018809916288, 0.267098790772231), y =
c(-1.83619592843732, 10.5409151638762, 10.2052855846451,
6.95125819851436, 13.2206069631951, 5.94909538717862, -7.02687007410588,
-2.05359861826618, -6.65931884321217, -1.34744800244265,
-2.38665484287344, 2.29780419495881, -4.44118874821063,
3.11743216589507, -2.62861240575578, 14.4966081247805, 7.06788716418861,
8.43590369737316, 4.71660071751589, 13.8947811368509, -2.49533557634811,
-1.26432119336991, 12.1277648344586, -2.60111803919118,
0.533596699115415, -0.777571506122737, -0.262691272819847,
0.0263709074589977, 5.49443920222744, 0.746084134760805))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

0.006

</td>

<td style="text-align:right;">

0.996

</td>

</tr>

<tr>

<td style="text-align:left;">

list(x = c(-0.505957462114257, 1.34303882517041, -0.214579408546869,
-0.179556530043387, -0.100190741213562, 0.712666307051405,
-0.0735644041263263, -0.0376341714670479, -0.681660478755657,
-0.324270272246319, 0.0601604404345152, -0.588894486259664,
0.531496192632572, -1.51839408178679, 0.306557860789766,
-1.53644982353759, -0.300976126836611, -0.528279904445006,
-0.652094780680999, -0.0568967778473925, -1.91435942568001,
1.17658331201856, -1.664972436212, -0.463530401472386,
-1.11592010504285, -0.750819001193448, 2.08716654562835,
0.0173956196932517, -1.28630053043433, -1.64060553441858), y =
c(5.1833035211261, 1.86876216429792, -0.24908304520935,
-4.57158276642605, -8.51793272046889, -5.60275764016486,
9.0712714848798, -2.39301892816187, -7.78937611842287, 15.2178807512414,
5.00591359525018, 0.312510166338842, 9.48460541513159, 8.26795467784576,
-2.37870958606872, 17.5995001266892, 0.196686576014221,
-8.07269826929436, 0.978940622575332, 3.46751767027385,
18.3198717680695, 2.74813571803237, 5.23146954309047, 1.4544463622095,
-0.361742605594027, 1.75444989897421, 7.56945306272185,
16.6741981824157, 9.26476160389645, 10.5412021955142))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

\-2.155

</td>

<td style="text-align:right;">

0.155

</td>

</tr>

<tr>

<td style="text-align:left;">

list(x = c(-1.23132342155804, 0.983895570053379, 0.219924803660651,
-1.46725002909224, 0.521022742648139, -0.158754604716016,
1.4645873119698, -0.766081999604665, -0.430211753928547,
-0.926109497377437, -0.17710396143654, 0.402011779486338,
-0.731748173119606, 0.830373167981674, -1.20808278630446,
-1.04798441280774, 1.44115770684428, -1.01584746530465,
0.411974712317515, -0.38107605110892, 0.409401839650934,
1.68887328620405, 1.58658843344197, -0.330907800682766,
-2.28523553529247, 2.49766158983416, 0.667066166765493, 0.5413273359637,
-0.0133995231459087, 0.510108422952926), y = c(0.837687346924892,
4.97476035054121, -0.830171868144279, -7.68883281849036,
8.98507137632915, 12.7462201320525, -0.183125501268262,
-6.86209684981829, 6.54133182402892, 1.6838586612127, -10.2557048874319,
2.01507452436457, -2.45689640304737, -0.411011949908394,
-6.17820160552759, 14.7501387053009, -0.341457084003431,
-9.35269421090104, 3.39436817738181, 3.86093284216464,
-4.97084744934169, -18.427753972546, -2.52888955109698,
6.03409818078081, 1.57769266515594, 1.30577144345521, 5.96560140237265,
-6.38952948936905, 9.75538485456056, 1.96221201365656))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

\-0.454

</td>

<td style="text-align:right;">

0.718

</td>

</tr>

<tr>

<td style="text-align:left;">

list(x = c(0.707310667398079, 1.03410773473746, 0.223480414915304,
-0.878707612866019, 1.16296455596733, -2.00016494478548,
-0.544790740001725, -0.255670709156989, -0.166121036765006,
1.02046390878411, 0.136221893102778, 0.407167603423836,
-0.0696548130129049, -0.247664341619331, 0.69555080661964,
1.1462283572158, -2.40309621489187, 0.572739555245841,
0.374724406778655, -0.425267721556076, 0.951012807576816,
-0.389237181718379, -0.284330661799574, 0.857409778079803,
1.7196272991206, 0.270054900937229, -0.42218400978764,
-1.18911329485959, -0.33103297887901, -0.939829326510021), y =
c(0.169070146065579, 4.78868184208184, -4.02353926371927,
20.7324386611701, 3.10316913807054, 9.99177222963708, -14.1865508912168,
7.23966943119973, -7.30725878659275, 8.50399417797749, 4.81520532714933,
-0.881662219289753, 11.3639225744316, -2.95845668507259,
-2.10556311782392, -5.07864927660281, -2.72473623879104,
8.68346690005597, 5.06673730958566, 9.10754898991602,
-0.758555528197928, 4.66133985551013, 3.72650673832301,
-8.08516238515796, 14.5753940903465, 2.95068852760872, 7.4136024397416,
8.75383621202326, 1.64244649614716, -0.162441571086358))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

\-0.514

</td>

<td style="text-align:right;">

0.730

</td>

</tr>

<tr>

<td style="text-align:left;">

list(x = c(0.893673702425513, -1.0472981490613, 1.97133738622415,
-0.383632106288362, 1.65414530227499, 1.51221269395063,
0.082965733585914, 0.5672209148515, -1.02454847953446,
0.323006503022436, 1.04361245835618, 0.0990784868971982,
-0.45413690915436, -0.65578185245044, -0.0359224226225114,
1.0691614606768, -0.483974930301277, -0.121010111327444,
-1.29414000382084, 0.494312836014856, 1.30790152011415,
1.49704100940278, 0.814702730897356, -1.86978879020261,
0.48202950412376, 0.456135603301202, -0.353400285829911,
0.170489470947982, -0.864035954126904, 0.679230774015656), y =
c(-0.312953455942104, -9.09508653354294, -0.598269214402721,
11.6480119083308, -0.363726198256996, 7.18132523760785,
8.69337125157664, 2.03110353657614, -0.491294914175769,
-1.74551286472361, 7.22968556696446, -5.51977949991016,
3.74097357066248, -0.0470696524683496, -14.0151862260986,
-7.96207711167116, 8.47723479087179, 0.647453569783142,
7.68007009341441, 15.3464599232195, 12.4219137782551, 6.7890114359851,
4.68674192269204, 0.636709252499232, 13.1573798815551, 6.216011818738,
-6.29844213134302, 0.899441081379922, -11.5687414639826,
0.619311458285083))

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

1.709

</td>

<td style="text-align:right;">

0.243

</td>

</tr>

</tbody>

</table>

``` r
#data_2 = append(rerun(10000, simulate_fun(30,2,1,50)),
#              rerun(10000, simulate_fun(30,2,2,50)),
#              rerun(10000, simulate_fun(30,2,3,50)),
#              rerun(10000, simulate_fun(30,2,4,50)),
#              rerun(10000, simulate_fun(30,2,5,50)),
#              rerun(10000, simulate_fun(30,2,6,50)))

#linear = map(data_2,~broom::tidy(lm(y~x, data = .)))

#summary_2 =  data_1%>%
             #tibble(linear,
                #     beta_1 = c(rep(1,10000),rep(2,10000),rep(3,10000),
                #               rep(4,10000),rep(5,10000),rep(6,10000)),
                #   estimate = map(linear, ~ .x[2,2]),
                #  p_value = map(linear, ~ .x[2,5]))%>% 
            # unnest(estimate:p_value) %>% 
            # select(-linear)
  

#summary_2
```

#### Step 2

``` r
set.seed(1)


sim_regression = function(n, beta_0, beta_1,var,simulate_fun) {
    tibble(
      true_beta = beta_1,
      sim_data =rerun(10000, simulate_fun(30,2,beta_1,50)),
      ls_fit = map(sim_data,~broom::tidy(lm(y ~ x, data = .))),
      estimate = map(ls_fit, ~ .x[2,2]),
      p_value = map(ls_fit, ~ .x[2,5]))%>% 
  unnest(estimate:p_value) %>% 
  select(-ls_fit)
  
}
      
beta_1 = list(1,2,3,4,5,6)

sim_results = 
  map(beta_1, ~sim_regression(30,2,.x,50,simulate_fun))%>% 
  bind_rows()
```

#### Step 3

``` r
beta_1_combine = list(0,1,2,3,4,5,6)

summary_final = 
  map(beta_1_combine, ~sim_regression(30,2,.x,50,simulate_fun))%>% 
  bind_rows()
```

#### Plot

``` r
plot_1 = summary_final%>%
         group_by(true_beta)%>%
         mutate(p_reject = sum(p.value < 0.05)/length(p.value))
  
  
  
  
  
ggplot(plot_1,aes(x = true_beta, y = p_reject, col = true_beta)) +
  geom_point() 
```

![](homework-5_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->
